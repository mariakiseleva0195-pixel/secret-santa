<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>–¢–∞–π–Ω—ã–π –°–∞–Ω—Ç–∞ ¬∑ –ê–Ω–∫–µ—Ç–∞ –ø–æ–∂–µ–ª–∞–Ω–∏–π</title>
  <!-- –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ: —à—Ä–∏—Ñ—Ç Google (—Ä–∞–±–æ—Ç–∞–µ—Ç –∏ –≤ Mini App) -->
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Manrope:wght@400;600;700&display=swap" rel="stylesheet" />

  <style>
    :root {
      --bg: #050816;
      --bg-soft: rgba(19, 25, 40, 0.95);
      --accent: #ff8a3d;
      --accent-soft: rgba(255, 138, 61, 0.12);
      --accent-2: #6a5cff;
      --text: #f9fafb;
      --muted: #9ca3af;
      --error: #f97373;
      --radius-xl: 24px;
      --radius-lg: 18px;
      --shadow-soft: 0 18px 60px rgba(0, 0, 0, 0.45);
      --border-subtle: 1px solid rgba(148, 163, 184, 0.25);
      --blur-bg: blur(22px);
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    html, body {
      height: 100%;
    }

    body {
      font-family: "Manrope", system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background:
        radial-gradient(120% 160% at 0% 0%, #1f2937 0, transparent 45%),
        radial-gradient(120% 160% at 100% 100%, #111827 0, transparent 45%),
        radial-gradient(circle at 20% -10%, rgba(255, 138, 61, 0.32), transparent 60%),
        radial-gradient(circle at 120% 120%, rgba(106, 92, 255, 0.32), transparent 60%),
        #020617;
      color: var(--text);
      display: flex;
      align-items: stretch;
      justify-content: center;
      padding: 16px;
    }

    .app-shell {
      width: 100%;
      max-width: 980px;
      margin: auto;
      display: flex;
      flex-direction: column;
      gap: 16px;
    }

    .card {
      background: linear-gradient(135deg, rgba(15, 23, 42, 0.96), rgba(15, 23, 42, 0.9));
      border-radius: var(--radius-xl);
      box-shadow: var(--shadow-soft);
      border: 1px solid rgba(148, 163, 184, 0.25);
      backdrop-filter: var(--blur-bg);
      padding: 20px 18px 18px;
    }

    @media (min-width: 720px) {
      .card {
        padding: 26px 26px 22px;
      }
    }

    .header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 16px;
      margin-bottom: 18px;
    }

    .header-main {
      display: flex;
      align-items: center;
      gap: 14px;
    }

    .logo-badge {
      width: 46px;
      height: 46px;
      border-radius: 999px;
      background: conic-gradient(from 210deg, #ff8a3d, #ffca63, #6a5cff, #22d3ee, #ff8a3d);
      padding: 2px;
      position: relative;
    }

    .logo-badge-inner {
      width: 100%;
      height: 100%;
      border-radius: inherit;
      background: radial-gradient(circle at 30% 0, rgba(255, 255, 255, 0.18), transparent 55%), #020617;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 20px;
      font-weight: 700;
      letter-spacing: 0.04em;
    }

    .tagline {
      font-size: 12px;
      text-transform: uppercase;
      letter-spacing: 0.22em;
      color: var(--muted);
      margin-bottom: 4px;
    }

    h1 {
      font-size: 20px;
      line-height: 1.3;
      font-weight: 700;
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      align-items: baseline;
    }

    .pill {
      font-size: 11px;
      padding: 3px 8px;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.5);
      color: var(--muted);
      display: inline-flex;
      align-items: center;
      gap: 4px;
      backdrop-filter: blur(10px);
    }

    .pill-dot {
      width: 6px;
      height: 6px;
      border-radius: 999px;
      background: #22c55e;
      box-shadow: 0 0 0 6px rgba(34, 197, 94, 0.18);
    }

    .subheader {
      font-size: 13px;
      color: var(--muted);
      margin-top: 4px;
      max-width: 440px;
    }

    .layout {
      display: grid;
      grid-template-columns: 1.05fr 0.9fr;
      gap: 16px;
      align-items: flex-start;
    }

    @media (max-width: 800px) {
      .layout {
        grid-template-columns: 1fr;
      }
    }

    .section-title {
      font-size: 13px;
      font-weight: 600;
      letter-spacing: 0.08em;
      text-transform: uppercase;
      color: var(--muted);
      margin-bottom: 10px;
    }

    form {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .field {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    label {
      font-size: 13px;
      font-weight: 500;
      color: #e5e7eb;
      display: flex;
      justify-content: space-between;
      align-items: baseline;
      gap: 10px;
    }

    label span.hint {
      font-size: 11px;
      color: var(--muted);
      font-weight: 400;
    }

    input[type="text"],
    textarea {
      border-radius: 14px;
      border: var(--border-subtle);
      background: radial-gradient(circle at 0 0, rgba(148, 163, 184, 0.2), transparent 55%), rgba(15, 23, 42, 0.96);
      padding: 9px 11px;
      font-size: 13px;
      color: var(--text);
      outline: none;
      transition: border 0.18s ease, box-shadow 0.18s ease, background 0.18s ease;
      resize: vertical;
      min-height: 38px;
    }

    textarea {
      min-height: 64px;
      max-height: 160px;
    }

    input::placeholder,
    textarea::placeholder {
      color: #6b7280;
      font-size: 12px;
    }

    input:focus,
    textarea:focus {
      border-color: rgba(248, 250, 252, 0.6);
      box-shadow: 0 0 0 1px rgba(248, 250, 252, 0.45);
      background: radial-gradient(circle at 0 0, rgba(148, 163, 184, 0.35), transparent 55%), rgba(15, 23, 42, 0.98);
    }

    .row-2 {
      display: flex;
      gap: 10px;
    }

    .row-2 > .field {
      flex: 1;
    }

    .chips {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin-top: 4px;
    }

    .chip {
      font-size: 11px;
      padding: 3px 8px;
      border-radius: 999px;
      background: rgba(15, 23, 42, 0.95);
      border: 1px dashed rgba(148, 163, 184, 0.5);
      color: var(--muted);
    }

    .checkbox-row {
      display: flex;
      align-items: flex-start;
      gap: 8px;
      margin-top: 4px;
    }

    .checkbox-row input[type="checkbox"] {
      margin-top: 1px;
      width: 15px;
      height: 15px;
      accent-color: var(--accent);
    }

    .checkbox-row label {
      font-size: 11.5px;
      color: var(--muted);
      cursor: pointer;
    }

    .actions {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 8px;
      margin-top: 2px;
    }

    .hint-soft {
      font-size: 11px;
      color: var(--muted);
    }

    button[type="submit"] {
      border: none;
      cursor: pointer;
      border-radius: 999px;
      padding: 9px 16px;
      font-size: 13px;
      font-weight: 600;
      letter-spacing: 0.04em;
      text-transform: uppercase;
      display: inline-flex;
      align-items: center;
      gap: 8px;
      background: radial-gradient(circle at 0 0, rgba(255, 255, 255, 0.18), transparent 55%), linear-gradient(135deg, var(--accent), #ffca63);
      color: #111827;
      box-shadow: 0 12px 30px rgba(248, 250, 252, 0.22);
      transition: transform 0.12s ease, box-shadow 0.12s ease, filter 0.12s ease;
      white-space: nowrap;
    }

    button[type="submit"]:hover {
      transform: translateY(-1px);
      box-shadow: 0 16px 40px rgba(248, 250, 252, 0.28);
      filter: brightness(1.03);
    }

    button[type="submit"]:active {
      transform: translateY(0);
      box-shadow: 0 10px 26px rgba(248, 250, 252, 0.18);
      filter: brightness(0.98);
    }

    button[type="submit"][disabled] {
      opacity: 0.5;
      cursor: default;
      transform: none;
      box-shadow: none;
    }

    .sparkle {
      font-size: 15px;
    }

    .status-line {
      min-height: 18px;
      font-size: 11.5px;
      margin-top: 4px;
      color: var(--muted);
    }

    .status-line.ok {
      color: #4ade80;
    }

    .status-line.err {
      color: var(--error);
    }

    .side-card {
      border-radius: var(--radius-xl);
      padding: 14px 14px 12px;
      border: 1px solid rgba(148, 163, 184, 0.4);
      background: linear-gradient(145deg, rgba(15, 23, 42, 0.96), rgba(15, 23, 42, 0.9));
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    @media (min-width: 900px) {
      .side-card {
        padding: 16px 16px 13px;
      }
    }

    .side-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 8px;
    }

    .side-title {
      font-size: 13px;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .side-badge {
      font-size: 11px;
      padding: 2px 7px;
      border-radius: 999px;
      background: var(--accent-soft);
      border: 1px solid rgba(248, 250, 252, 0.16);
      color: #fed7aa;
    }

    .side-description {
      font-size: 11.5px;
      color: var(--muted);
    }

    .responses-list {
      margin-top: 4px;
      border-radius: var(--radius-lg);
      border: 1px solid rgba(55, 65, 81, 0.8);
      background: radial-gradient(circle at 0 0, rgba(55, 65, 81, 0.5), transparent 60%), rgba(15, 23, 42, 0.9);
      max-height: 270px;
      overflow: hidden;
      display: flex;
      flex-direction: column;
    }

    .responses-header {
      display: grid;
      grid-template-columns: 1.4fr 1.5fr 1.5fr;
      gap: 6px;
      padding: 7px 10px;
      font-size: 11px;
      color: #e5e7eb;
      border-bottom: 1px solid rgba(55, 65, 81, 0.9);
      background: linear-gradient(to right, rgba(15, 23, 42, 0.96), rgba(15, 23, 42, 0.9));
      position: sticky;
      top: 0;
      z-index: 5;
    }

    .responses-body {
      overflow-y: auto;
      scrollbar-width: thin;
      scrollbar-color: rgba(148, 163, 184, 0.8) transparent;
    }

    .responses-body::-webkit-scrollbar {
      width: 6px;
    }

    .responses-body::-webkit-scrollbar-track {
      background: transparent;
    }

    .responses-body::-webkit-scrollbar-thumb {
      background: rgba(148, 163, 184, 0.8);
      border-radius: 999px;
    }

    .response-row {
      display: grid;
      grid-template-columns: 1.4fr 1.5fr 1.5fr;
      gap: 6px;
      padding: 7px 10px 7px;
      font-size: 11.5px;
      border-bottom: 1px solid rgba(31, 41, 55, 0.9);
    }

    .response-row:last-of-type {
      border-bottom: none;
    }

    .response-row:nth-of-type(odd) {
      background: rgba(15, 23, 42, 0.85);
    }

    .response-row:nth-of-type(even) {
      background: rgba(15, 23, 42, 0.75);
    }

    .response-name {
      font-weight: 600;
      white-space: nowrap;
      text-overflow: ellipsis;
      overflow: hidden;
    }

    .response-text {
      color: #d1d5db;
      overflow: hidden;
      text-overflow: ellipsis;
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
    }

    .empty-state {
      padding: 14px 10px 16px;
      font-size: 11.5px;
      text-align: left;
      color: var(--muted);
      display: flex;
      gap: 8px;
      align-items: flex-start;
    }

    .dot-pulse {
      display: inline-flex;
      gap: 3px;
      align-items: center;
    }

    .dot-pulse span {
      width: 4px;
      height: 4px;
      border-radius: 999px;
      background: #e5e7eb;
      opacity: 0.55;
      animation: pulse 1.2s infinite ease-in-out;
    }

    .dot-pulse span:nth-child(2) { animation-delay: 0.15s; }
    .dot-pulse span:nth-child(3) { animation-delay: 0.3s; }

    @keyframes pulse {
      0%, 100% { transform: translateY(0); opacity: 0.4; }
      50% { transform: translateY(-2px); opacity: 1; }
    }

    .footer {
      font-size: 11px;
      color: var(--muted);
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 8px;
      margin-top: 6px;
    }

    .footer span strong {
      color: #e5e7eb;
      font-weight: 600;
    }

    .footer a {
      color: #c4b5fd;
      text-decoration: none;
      border-bottom: 1px dashed rgba(196, 181, 253, 0.6);
    }
    .footer a:hover { border-bottom-style: solid; }
  </style>
</head>
<body>
  <div class="app-shell">
    <main class="card">
      <header class="header">
        <div class="header-main">
          <div class="logo-badge" aria-hidden="true">
            <div class="logo-badge-inner">üéÅ</div>
          </div>
          <div>
            <div class="tagline">–ö–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤ ¬∑ –¢–∞–π–Ω—ã–π –°–∞–Ω—Ç–∞</div>
            <h1>–ê–Ω–∫–µ—Ç–∞ –ø–æ–∂–µ–ª–∞–Ω–∏–π</h1>
            <p class="subheader">
              –ó–∞–ø–æ–ª–Ω–∏ —Ñ–æ—Ä–º—É, —á—Ç–æ–±—ã –ø–æ–ª—É—á–∞—Ç–µ–ª—å –ø–æ–ª—É—á–∏–ª –ø–æ–¥–∞—Ä–æ–∫, –∫–æ—Ç–æ—Ä—ã–π –µ–≥–æ —Ç–æ—á–Ω–æ –ø–æ—Ä–∞–¥—É–µ—Ç üéÅ
            </p>
          </div>
        </div>
      </header>

      <section class="layout">
        <section>
          <div class="section-title">–¢–≤–æ–∏ –ø–æ–∂–µ–ª–∞–Ω–∏—è</div>
          <form id="santa-form">
            <div class="field">
              <label for="name">
                –ò–º—è –§–∞–º–∏–ª–∏—è
                <span class="hint">—Ç–∞–∫ —Ç–µ–±—è —É–≤–∏–¥–∏—Ç –æ—Ä–≥–∞–Ω–∏–∑–∞—Ç–æ—Ä</span>
              </label>
              <input id="name" name="name" type="text" required placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –ú–∞—Ä–∏—è –ö–∏—Å–µ–ª—ë–≤–∞" />
            </div>

            
              <div class="field">
              <label>–ë—é–¥–∂–µ—Ç –ø–æ–¥–∞—Ä–∫–∞ —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π ‚Äî 3500 ‚ÇΩ</label>
            </div>

            <div class="field">
              <label for="wishlist">
                –ß—Ç–æ —Ç–µ–±—è –ø–æ—Ä–∞–¥—É–µ—Ç?
                <span class="hint">–∏–¥–µ–∞–ª—å–Ω–æ ‚Äî –Ω–µ—Å–∫–æ–ª—å–∫–æ –∏–¥–µ–π</span>
              </label>
              <textarea id="wishlist" name="wishlist" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: —Å–≤–µ—á–∏ —Å –ø—Ä—è–Ω—ã–º –∞—Ä–æ–º–∞—Ç–æ–º, –≤–∫—É—Å–Ω—ã–π –∫–æ—Ñ–µ, –∫–Ω–∏–≥–∞ –ø–æ —Å–∞–º–æ—Ä–∞–∑–≤–∏—Ç–∏—é, —É—é—Ç–Ω—ã–µ –Ω–æ—Å–∫–∏ 38‚Äì39 —Ä–∞–∑–º–µ—Ä–∞‚Ä¶"></textarea>
              <div class="chips" aria-hidden="true">
                <div class="chip">‚òï –∫–æ—Ñ–µ / —á–∞–π</div>
                <div class="chip">üìö –∫–Ω–∏–≥–∏</div>
                <div class="chip">üïØÔ∏è —Å–≤–µ—á–∏</div>
                <div class="chip">üç´ —Å–ª–∞–¥–æ—Å—Ç–∏</div>
                <div class="chip">üß∏ –º–∏–ª—ã–µ —à—Ç—É–∫–∏ –Ω–∞ —Å—Ç–æ–ª</div>
              </div>
            </div>

            <div class="field">
              <label for="no-gifts">
                –ß—Ç–æ –Ω–µ —Å—Ç–æ–∏—Ç –¥–∞—Ä–∏—Ç—å?
                <span class="hint">–∞–ª–ª–µ—Ä–≥–∏–∏, —Ç–∞–±—É, –Ω–µ–∂–µ–ª–∞—Ç–µ–ª—å–Ω—ã–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏</span>
              </label>
              <textarea id="no-gifts" name="noGifts" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –Ω–µ—Ç –ø–∞—Ä—Ñ—é–º—É, –∞–ª–∫–æ–≥–æ–ª—å –Ω–µ –ø—å—é, –∞–ª–ª–µ—Ä–≥–∏—è –Ω–∞ —Ü–∏—Ç—Ä—É—Å—ã –∏ –æ—Ä–µ—Ö–∏, –Ω–µ –ª—é–±–ª—é –∞—Ä–æ–º–∞—Ç –ª–∞–≤–∞–Ω–¥—ã‚Ä¶"></textarea>
            </div>

            <div class="field">
              <label for="extra">
                –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –æ—Ä–≥–∞–Ω–∏–∑–∞—Ç–æ—Ä—É
                <span class="hint">–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ</span>
              </label>
              <textarea id="extra" name="extra" placeholder="–°—é–¥–∞ –º–æ–∂–Ω–æ –Ω–∞–ø–∏—Å–∞—Ç—å –æ—Å–æ–±—ã–µ –ø–æ–∂–µ–ª–∞–Ω–∏—è, —Ä–∞–∑–º–µ—Ä –æ–¥–µ–∂–¥—ã, —à—É—Ç–∫–∏ –¥–ª—è –≤–µ–¥—É—â–µ–≥–æ –∏ —Ç.–ø."></textarea>
            </div>

            <div class="checkbox-row">
              <input type="checkbox" id="consent" required />
              <label for="consent">
                –Ø —Å–æ–≥–ª–∞—Å–µ–Ω(–∞) –Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫—É —ç—Ç–∏—Ö –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ –∏–≥—Ä—ã ¬´–¢–∞–π–Ω—ã–π –°–∞–Ω—Ç–∞¬ª. –í—Å—ë –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–æ —Ç–æ–ª—å–∫–æ –≤ —Ä–∞–º–∫–∞—Ö –∫–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–∞.
              </label>
            </div>

            <div class="actions">
              <button type="submit" id="submit-btn">
                <span class="sparkle">‚ú®</span>
                –û—Ç–ø—Ä–∞–≤–∏—Ç—å –ø–æ–∂–µ–ª–∞–Ω–∏—è
              </button>
              <p class="hint-soft">
                –ú–æ–∂–Ω–æ –≤–µ—Ä–Ω—É—Ç—å—Å—è –∏ –∑–∞–ø–æ–ª–Ω–∏—Ç—å —Ñ–æ—Ä–º—É –µ—â—ë —Ä–∞–∑,
                <br />–µ—Å–ª–∏ –∑–∞—Ö–æ—á–µ—à—å –æ–±–Ω–æ–≤–∏—Ç—å —Å–≤–æ–∏ –ø–æ–∂–µ–ª–∞–Ω–∏—è.
              </p>
            </div>

            <div id="status" class="status-line" aria-live="polite"></div>
          </form>
        </section>

        <aside>
          <div class="side-card">
            <div class="side-header">
              <div class="side-title">
                –°–ø–∏—Å–æ–∫ –ø–æ–∂–µ–ª–∞–Ω–∏–π
                <span class="side-badge" id="counter-badge">–æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è‚Ä¶</span>
              </div>
            </div>
            <p class="side-description">
              –ó–¥–µ—Å—å —Å–æ–±–∏—Ä–∞—é—Ç—Å—è –æ—Ç–≤–µ—Ç—ã –≤—Å–µ—Ö —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤. –î–∞—Ä–∏—Ç–µ–ª—å –Ω–µ —É–≤–∏–¥–∏—Ç —ç—Ç—É —Å—Ç—Ä–∞–Ω–∏—Ü—É ‚Äî —Ç–æ–ª—å–∫–æ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ç–æ—Ä.
            </p>

            <div class="responses-list">
              <div class="responses-header">
                <span>–£—á–∞—Å—Ç–Ω–∏–∫</span>
                <span>–•–æ—á–µ—Ç –ø–æ–ª—É—á–∏—Ç—å</span>
                <span>–ù–µ –¥–∞—Ä–∏—Ç—å</span>
              </div>
              <div class="responses-body" id="responses">
                <div class="empty-state" id="empty-state">
                  <span>üéÑ</span>
                  <span>
                    –ü–æ–∫–∞ –Ω–µ—Ç –æ—Ç–≤–µ—Ç–æ–≤ –∏–ª–∏ –∏–¥—ë—Ç –∑–∞–≥—Ä—É–∑–∫–∞.
                    <span class="dot-pulse"><span></span><span></span><span></span></span>
                    <br />
                    –ö–∞–∫ —Ç–æ–ª—å–∫–æ –ø–µ—Ä–≤—ã–µ —É—á–∞—Å—Ç–Ω–∏–∫–∏ –∑–∞–ø–æ–ª–Ω—è—Ç –∞–Ω–∫–µ—Ç—É, –∏—Ö –ø–æ–∂–µ–ª–∞–Ω–∏—è –ø–æ—è–≤—è—Ç—Å—è –∑–¥–µ—Å—å.
                  </span>
                </div>
              </div>
            </div>
          </div>
        </aside>
      </section>

      <footer class="footer">
        <span>–û—Ä–≥–∞–Ω–∏–∑–∞—Ç–æ—Ä: <strong>–¢–∞–π–Ω—ã–π –°–∞–Ω—Ç–∞</strong></span>
        <span>–î–∞–Ω–Ω—ã–µ —Ö—Ä–∞–Ω–∏–º –≤ –∑–∞—â–∏—â—ë–Ω–Ω–æ–π –±–∞–∑–µ Firebase.</span>
      </footer>
    </main>
  </div>

  <!-- Telegram Mini App API -->
  <script src="https://telegram.org/js/telegram-web-app.js"></script>

  <!-- Firebase SDK v12 (–º–æ–¥—É–ª—å–Ω—ã–π) -->
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-app.js";
  import { getFirestore, collection, addDoc, serverTimestamp, query, orderBy, onSnapshot } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-firestore.js";
  import { getAnalytics } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-analytics.js";

  const firebaseConfig = {
    apiKey: "AIzaSyD_EEes15Jz5q5t4Wyi2R1V2u-1274Xh4w",
    authDomain: "secret-santa-d5cdd.firebaseapp.com",
    projectId: "secret-santa-d5cdd",
    storageBucket: "secret-santa-d5cdd.firebasestorage.app",
    messagingSenderId: "902557716524",
    appId: "1:902557716524:web:b125e1a1e959d89ad10189",
    measurementId: "G-6497542QZ1"
  };

  const app = initializeApp(firebaseConfig);
  const analytics = getAnalytics(app);
  const db = getFirestore(app);

  const form = document.getElementById("santa-form");
  const statusEl = document.getElementById("status");
  const submitBtn = document.getElementById("submit-btn");
  const responsesEl = document.getElementById("responses");
  const emptyStateEl = document.getElementById("empty-state");
  const counterBadge = document.getElementById("counter-badge");

  let tg = window.Telegram && window.Telegram.WebApp ? window.Telegram.WebApp : null;
  if (tg) {
    tg.expand();
    tg.setBackgroundColor("#050816");
    tg.setHeaderColor("secondary_bg_color");
  }

  function setStatus(message, type) {
    statusEl.textContent = message || "";
    statusEl.className = "status-line";
    if (type === "ok") statusEl.classList.add("ok");
    if (type === "err") statusEl.classList.add("err");
  }

  async function submitForm(e) {
    e.preventDefault();
    if (!form.reportValidity()) return;

    const payload = {
      name: form.name.value.trim(),
      wishlist: form.wishlist.value.trim(),
      noGifts: form["noGifts"].value.trim(),
      extra: form.extra.value.trim(),
      tgUser: tg && tg.initDataUnsafe && tg.initDataUnsafe.user ? tg.initDataUnsafe.user : null,
      createdAt: serverTimestamp(),
    };

    if (!payload.name) {
      setStatus("–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —É–∫–∞–∂–∏ –ò–º—è –∏ –§–∞–º–∏–ª–∏—é.", "err");
      return;
    }

    submitBtn.disabled = true;
    setStatus("–û—Ç–ø—Ä–∞–≤–ª—è–µ–º –ø–æ–∂–µ–ª–∞–Ω–∏—è‚Ä¶", "");

    try {
      await addDoc(collection(db, "secret-santa-wishes"), payload);
      setStatus("–ì–æ—Ç–æ–≤–æ! –ü–æ–∂–µ–ª–∞–Ω–∏—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –≤ Firebase.", "ok");
    } catch (err) {
      console.error(err);
      setStatus("–ù–µ –ø–æ–ª—É—á–∏–ª–æ—Å—å —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å. –ü–æ–ø—Ä–æ–±—É–π –µ—â—ë —Ä–∞–∑.", "err");
    } finally {
      submitBtn.disabled = false;
    }
  }

  function normalizeRow(row) {
    return {
      name: row.name || "‚Äî",
      wishlist: row.wishlist || "‚Äî",
      noGifts: row.noGifts || row.no_gifts || "‚Äî",
    };
  }

  function renderRows(rows) {
    responsesEl.innerHTML = "";
    if (!rows || !rows.length) {
      responsesEl.appendChild(emptyStateEl);
      emptyStateEl.style.display = "flex";
      counterBadge.textContent = "0 —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤";
      return;
    }
    emptyStateEl.style.display = "none";

    rows.forEach((r) => {
      const row = normalizeRow(r);
      const div = document.createElement("div");
      div.className = "response-row";
      div.innerHTML = `
        <div class="response-name">${escapeHtml(row.name)}</div>
        <div class="response-text">${escapeHtml(row.wishlist)}</div>
        <div class="response-text">${escapeHtml(row.noGifts)}</div>
      `;
      responsesEl.appendChild(div);
    });

    const count = rows.length;
    counterBadge.textContent = count === 1 ? "1 —É—á–∞—Å—Ç–Ω–∏–∫" : `${count} —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤`;
  }

  function escapeHtml(str) {
    return String(str || "").replace(/[&<>"']/g, c => ({"&":"&amp;","<":"&lt;",">":"&gt;","\"":"&quot;","'":"&#039;"}[c]));
  }

  function subscribeToResponses() {
    counterBadge.textContent = "–æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è‚Ä¶";
    const q = query(collection(db, "secret-santa-wishes"), orderBy("createdAt", "desc"));
    onSnapshot(q, snapshot => {
      const rows = snapshot.docs.map(doc => doc.data());
      renderRows(rows);
    });
  }

  form.addEventListener("submit", submitForm);
  document.addEventListener("DOMContentLoaded", () => subscribeToResponses());
</script>
</body>
</html>
  
